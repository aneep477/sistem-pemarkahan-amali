<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borang Penilaian Kumpulan - Program Bina Insan Guru</title>
    <script type="text/javascript" src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        h1, h2 { text-align: center; color: #333; }
        .section { margin-bottom: 30px; padding: 15px; background-color: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #4CAF50; color: white; }
        .rubric { font-size: 0.9em; margin-top: 10px; }
        .rubric span { padding: 5px; border-radius: 4px; margin-right: 5px; }
        .lemak { background-color: red; color: white; }
        .sederhana { background-color: orange; color: white; }
        .kepuasan { background-color: yellow; color: black; }
        .cemerlang { background-color: lightgreen; color: black; }
        .amat { background-color: green; color: white; }
        #memberList { display: none; }
        button { background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #45a049; }
        input[type="file"], input[type="text"], input[type="number"] { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Borang Penilaian Kumpulan Berdasarkan HP untuk Program Bina Insan Guru</h1>
    
    <div class="section">
        <h2>Muat Naik Senarai Pelajar (Excel)</h2>
        <input type="file" id="uploadExcel" accept=".xlsx, .xls">
        <button onclick="processExcel()">Proses Fail Excel</button>
        <p>Format Excel mestilah mempunyai header: Nama Pelajar, No. KP, AGiliran, Kelas, Kumpulan</p>
    </div>
    
    <div class="section">
        <label for="groupNo">No Kumpulan:</label>
        <input type="text" id="groupNo" required>
        <button onclick="loadMembers()">Muat Senarai Ahli</button>
    </div>
    
    <div id="memberList">
        <h2>Senarai Ahli Kumpulan</h2>
        <ul id="members"></ul>
        
        <form id="assessmentForm">
            <!-- Kriteria 1: HP3 Kemahiran Komunikasi -->
            <div class="section">
                <h2>HP3 Kemahiran Komunikasi (30%)</h2>
                <div class="rubric">
                    <span class="lemak">1: Lemah - Tidak berkomunikasi dengan baik</span>
                    <span class="sederhana">2: Sederhana - Komunikasi terhad</span>
                    <span class="kepuasan">3: Kepuasan - Komunikasi aktif</span>
                    <span class="cemerlang">4: Cemerlang - Komunikasi efektif</span>
                    <span class="amat">5: Amat Cemerlang - Komunikasi luar biasa</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nama Ahli</th>
                            <th>Markah (1-5)</th>
                        </tr>
                    </thead>
                    <tbody id="table-komunikasi"></tbody>
                </table>
            </div>
            
            <!-- Kriteria 2: HP4 Kemahiran Interpersonal -->
            <div class="section">
                <h2>HP4 Kemahiran Interpersonal (30%)</h2>
                <div class="rubric">
                    <span class="lemak">1: Lemah - Tidak membina hubungan</span>
                    <span class="sederhana">2: Sederhana - Hubungan tidak konsisten</span>
                    <span class="kepuasan">3: Kepuasan - Bekerjasama dengan baik</span>
                    <span class="cemerlang">4: Cemerlang - Hubungan kukuh</span>
                    <span class="amat">5: Amat Cemerlang - Hubungan sangat kukuh</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nama Ahli</th>
                            <th>Markah (1-5)</th>
                        </tr>
                    </thead>
                    <tbody id="table-interpersonal"></tbody>
                </table>
            </div>
            
            <!-- Kriteria 3: HP8 Kemahiran Praktikal -->
            <div class="section">
                <h2>HP8 Kemahiran Praktikal (15%)</h2>
                <div class="rubric">
                    <span class="lemak">1: Lemah - Tidak melaksanakan tugas</span>
                    <span class="sederhana">2: Sederhana - Melaksanakan tugas asas</span>
                    <span class="kepuasan">3: Kepuasan - Melaksanakan dengan baik</span>
                    <span class="cemerlang">4: Cemerlang - Melaksanakan dengan cekap</span>
                    <span class="amat">5: Amat Cemerlang - Melaksanakan dengan inovatif</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nama Ahli</th>
                            <th>Markah (1-5)</th>
                        </tr>
                    </thead>
                    <tbody id="table-praktikal"></tbody>
                </table>
            </div>
            
            <!-- Kriteria 4: HP9 Autonomi dan Tanggungjawab -->
            <div class="section">
                <h2>HP9 Autonomi dan Tanggungjawab (15%)</h2>
                <div class="rubric">
                    <span class="lemak">1: Lemah - Bergantung kepada orang lain</span>
                    <span class="sederhana">2: Sederhana - Sedikit autonomi</span>
                    <span class="kepuasan">3: Kepuasan - Bertanggungjawab</span>
                    <span class="cemerlang">4: Cemerlang - Autonomi tinggi</span>
                    <span class="amat">5: Amat Cemerlang - Kepimpinan autonomi</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nama Ahli</th>
                            <th>Markah (1-5)</th>
                        </tr>
                    </thead>
                    <tbody id="table-autonomi"></tbody>
                </table>
            </div>
            
            <!-- Kriteria 5: HP10 Kepimpinan -->
            <div class="section">
                <h2>HP10 Kepimpinan (10%)</h2>
                <div class="rubric">
                    <span class="lemak">1: Lemah - Tidak menunjukkan kepimpinan</span>
                    <span class="sederhana">2: Sederhana - Kepimpinan minimum</span>
                    <span class="kepuasan">3: Kepuasan - Memimpin dengan baik</span>
                    <span class="cemerlang">4: Cemerlang - Memimpin efektif</span>
                    <span class="amat">5: Amat Cemerlang - Memimpin inspirasi</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nama Ahli</th>
                            <th>Markah (1-5)</th>
                        </tr>
                    </thead>
                    <tbody id="table-kepimpinan"></tbody>
                </table>
            </div>

            <div id="totalSection" class="section" style="display: none;">
                <h2>Jumlah Markah</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Nama Ahli</th>
                            <th>Jumlah (%)</th>
                            <th>Tahap</th>
                        </tr>
                    </thead>
                    <tbody id="totalTable"></tbody>
                </table>
            </div>
            
            <button type="button" onclick="calculateTotals()">Kira Jumlah Markah</button>
            <button type="submit">Hantar Penilaian</button>
        </form>
    </div>

    <script>
        let groups = {}; // Objek untuk menyimpan kumpulan dinamik
        const colors = ['red', 'orange', 'yellow', 'lightgreen', 'green'];

        function processExcel() {
            if (typeof XLSX === 'undefined') {
                alert('Perpustakaan SheetJS tidak dimuat. Sila semak sambungan internet atau tag skrip dalam HTML.');
                return;
            }
            const fileInput = document.getElementById('uploadExcel');
            const file = fileInput.files[0];
            if (!file) {
                alert('Sila pilih fail Excel terlebih dahulu.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = e.target.result;
                const workbook = XLSX.read(data, { type: 'binary' });
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                // Asumsi baris pertama adalah header
                const headers = json[0];
                const namaIdx = headers.indexOf('Nama Pelajar');
                const kumpulanIdx = headers.indexOf('Kumpulan');

                if (namaIdx === -1 || kumpulanIdx === -1) {
                    alert('Fail Excel tidak mempunyai header yang betul. Pastikan ada "Nama Pelajar" dan "Kumpulan".');
                    return;
                }

                groups = {};
                for (let i = 1; i < json.length; i++) {
                    const row = json[i];
                    const nama = row[namaIdx];
                    const kumpulan = row[kumpulanIdx];
                    if (kumpulan && nama) {
                        if (!groups[kumpulan]) {
                            groups[kumpulan] = [];
                        }
                        groups[kumpulan].push(nama);
                    }
                }
                alert('Senarai pelajar telah dimuat naik dan diproses.');
            };
            reader.readAsBinaryString(file);
        }

        function loadMembers() {
            const groupNo = document.getElementById('groupNo').value.trim();
            if (Object.keys(groups).length === 0) {
                alert('Sila muat naik dan proses fail Excel terlebih dahulu.');
                return;
            }
            const members = groups[groupNo];
            if (!members) {
                alert('No kumpulan tidak wujud dalam data.');
                return;
            }

            const memberList = document.getElementById('members');
            memberList.innerHTML = '';
            members.forEach(member => {
                const li = document.createElement('li');
                li.textContent = member;
                memberList.appendChild(li);
            });

            // Populate tables
            const tables = ['table-komunikasi', 'table-interpersonal', 'table-praktikal', 'table-autonomi', 'table-kepimpinan'];
            tables.forEach(tableId => {
                const tbody = document.getElementById(tableId);
                tbody.innerHTML = '';
                members.forEach(member => {
                    const tr = document.createElement('tr');
                    const tdName = document.createElement('td');
                    tdName.textContent = member;
                    const tdScore = document.createElement('td');
                    const select = document.createElement('select');
                    select.innerHTML = '<option value="">Pilih</option>';
                    for (let i = 1; i <= 5; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = i;
                        select.appendChild(option);
                    }
                    select.onchange = function() {
                        const val = parseInt(this.value);
                        if (!isNaN(val)) {
                            tdScore.style.backgroundColor = colors[val - 1];
                        } else {
                            tdScore.style.backgroundColor = '';
                        }
                    };
                    tdScore.appendChild(select);
                    tr.appendChild(tdName);
                    tr.appendChild(tdScore);
                    tbody.appendChild(tr);
                });
            });

            document.getElementById('memberList').style.display = 'block';
        }

        function calculateTotals() {
            const tables = ['table-komunikasi', 'table-interpersonal', 'table-praktikal', 'table-autonomi', 'table-kepimpinan'];
            const weights = [30, 30, 15, 15, 10];
            const members = groups[document.getElementById('groupNo').value.trim()];
            const totalTable = document.getElementById('totalTable');
            totalTable.innerHTML = '';

            let allFilled = true;

            members.forEach((member, index) => {
                let scores = [];
                tables.forEach(tableId => {
                    const select = document.querySelector(`#${tableId} tr:nth-child(${index + 1}) select`);
                    const val = parseInt(select.value);
                    if (isNaN(val)) {
                        allFilled = false;
                        return;
                    }
                    scores.push(val);
                });

                if (!allFilled) return;

                let total = 0;
                scores.forEach((score, i) => {
                    total += score * weights[i];
                });
                total /= 5;

                let level = '';
                let color = '';
                if (total < 50) {
                    level = 'Lemah';
                    color = 'red';
                } else if (total < 60) {
                    level = 'Sederhana';
                    color = 'orange';
                } else if (total < 75) {
                    level = 'Kepuasan';
                    color = 'yellow';
                } else if (total < 90) {
                    level = 'Cemerlang';
                    color = 'lightgreen';
                } else {
                    level = 'Amat Cemerlang';
                    color = 'green';
                }

                const tr = document.createElement('tr');
                const tdName = document.createElement('td');
                tdName.textContent = member;
                const tdTotal = document.createElement('td');
                tdTotal.textContent = total.toFixed(2);
                const tdLevel = document.createElement('td');
                tdLevel.textContent = level;
                tdLevel.style.backgroundColor = color;
                tr.appendChild(tdName);
                tr.appendChild(tdTotal);
                tr.appendChild(tdLevel);
                totalTable.appendChild(tr);
            });

            if (!allFilled) {
                alert('Sila isi semua markah terlebih dahulu.');
                return;
            }

            document.getElementById('totalSection').style.display = 'block';
        }

        document.getElementById('assessmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Penilaian telah dihantar! (Ini adalah simulasi sahaja)');
        });
    </script>
</body>
</html>
